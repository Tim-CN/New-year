<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ğŸ§§ ä¸™åˆæ–°æ˜¥ Â· ç‘ç è¿ç¥¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(145deg, #9f1f1f 0%, #c53a2b 40%, #e86334 100%);
            background-attachment: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
            padding: 1rem;
        }

        /* ç¯ç¬¼è£…é¥° */
        .lantern-left, .lantern-right {
            position: absolute;
            top: 20px;
            width: 100px;
            height: 140px;
            background: radial-gradient(circle at 30% 20%, #ffcf9a, #d4320f 70%);
            border-radius: 50% 50% 40% 40%;
            box-shadow: 0 10px 20px rgba(180, 30, 0, 0.5), inset -5px -10px 10px rgba(0,0,0,0.2);
            transform-origin: top center;
            animation: swing 3s infinite ease-in-out;
            z-index: 5;
        }
        .lantern-left {
            left: 10px;
        }
        .lantern-right {
            right: 10px;
            animation-delay: 1s;
        }
        .lantern-left::before, .lantern-right::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #c98b2b;
            border-radius: 30% 30% 0 0;
            box-shadow: 0 -2px 5px #ffb669;
        }
        .lantern-left::after, .lantern-right::after {
            content: 'ç¦';
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            font-weight: bold;
            color: #fde58b;
            text-shadow: 2px 2px 0 #b5451a;
            font-family: 'KaiTi', 'æ¥·ä½“', serif;
        }
        @keyframes swing {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(8deg); }
            75% { transform: rotate(-8deg); }
            100% { transform: rotate(0deg); }
        }

        /* é‡‘è‰²ç¥¥äº‘çº¹ (èƒŒæ™¯è£…é¥°) */
        .cloud {
            position: absolute;
            background: rgba(255, 235, 150, 0.15);
            border-radius: 80% 20% 70% 30% / 30% 70% 20% 80%;
            width: 200px;
            height: 80px;
            filter: blur(8px);
            z-index: 1;
        }
        .cloud1 { top: 15%; left: 5%; }
        .cloud2 { bottom: 10%; right: 3%; width: 280px; height: 100px; background: rgba(255, 200, 100, 0.1); }

        /* ä¸»å¡ç‰‡ */
        .activate-card {
            position: relative;
            z-index: 20;
            background: rgba(255, 250, 235, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 3px solid #f7d97e;
            border-radius: 48px 48px 32px 32px;
            box-shadow: 0 30px 40px rgba(160, 30, 0, 0.4), 0 0 0 2px #fcc15e inset, 0 0 0 5px #b33f1f inset;
            padding: 2.5rem 2rem;
            max-width: 520px;
            width: 100%;
            text-align: center;
        }

        /* æ–°å¹´ä¸»æ ‡é¢˜ */
        .newyear-title {
            font-size: 2.6rem;
            font-weight: 800;
            color: #a3201a;
            text-shadow: 3px 3px 0 #fee282, 5px 5px 0 rgba(255, 100, 0, 0.3);
            letter-spacing: 6px;
            margin-bottom: 0.2rem;
            line-height: 1.2;
        }
        .newyear-sub {
            font-size: 1.4rem;
            font-weight: 400;
            color: #cf4f2b;
            background: #fef1bc;
            display: inline-block;
            padding: 0.3rem 2rem;
            border-radius: 40px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 0 #b7621a;
            font-family: 'KaiTi', serif;
        }

        /* è¾“å…¥æ¡†ç»„ */
        .code-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #772b1a;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .code-label span {
            font-size: 1.6rem;
        }

        .code-input {
            width: 100%;
            padding: 1rem 1.2rem;
            font-size: 1.8rem;
            text-align: center;
            letter-spacing: 4px;
            font-weight: 600;
            background: #fffbf0;
            border: 3px solid #c5481f;
            border-radius: 60px;
            outline: none;
            color: #3c1d0e;
            caret-color: #d4451e;
            box-shadow: inset 0 3px 8px rgba(150, 50, 0, 0.2), 0 4px 0 #954f2a;
            transition: all 0.2s;
            text-transform: lowercase; /* è§†è§‰ä¸Šå°å†™ï¼Œä½†ä¸å½±å“å®é™…å€¼ */
        }
        .code-input:focus {
            border-color: #ffb347;
            box-shadow: inset 0 3px 8px rgba(200, 80, 0, 0.2), 0 4px 0 #c06924, 0 0 0 3px #fde6a2;
        }
        .code-input::placeholder {
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: #bc7a5a;
            text-transform: lowercase;
        }

        /* æç¤ºä¿¡æ¯ */
        .message-area {
            min-height: 3.2rem;
            margin: 0.8rem 0 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: #b13b1a;
            text-shadow: 0 1px 0 #ffd9a8;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .error-message {
            color: #a5220c;
            background: #ffdbac;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
            border-left: 6px solid #c0451b;
            font-weight: 600;
        }
        .success-message {
            color: #1f7a3b;
            background: #e1ffc6;
            border-left: 6px solid #2e9c47;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
        }
        .info-message {
            color: #7b4a2a;
            background: #ffeec2;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
        }

        /* æ¿€æ´»æŒ‰é’® */
        .activate-btn {
            background: linear-gradient(145deg, #fdc830, #f37335);
            border: none;
            padding: 1.2rem 1.5rem;
            width: 100%;
            font-size: 2rem;
            font-weight: 800;
            color: #2f1406;
            text-shadow: 2px 2px 0 #feda7a;
            border-radius: 60px;
            box-shadow: 0 10px 0 #aa401a, 0 6px 20px #ff8c42;
            cursor: pointer;
            transition: all 0.08s linear;
            letter-spacing: 4px;
            border: 2px solid #fdea9e;
            transform: translateY(0);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .activate-btn:active {
            transform: translateY(6px);
            box-shadow: 0 4px 0 #aa401a, 0 10px 20px #ffb161;
        }
        .activate-btn:disabled {
            opacity: 0.7;
            transform: translateY(5px);
            box-shadow: 0 5px 0 #7b3a1f;
            cursor: not-allowed;
            background: #d89c6c;
        }
        .activate-btn i {
            font-size: 2rem;
            font-style: normal;
            filter: drop-shadow(0 2px 2px #b3511c);
        }

        /* åº•éƒ¨ç¤ºä¾‹ */
        .demo-hint {
            margin-top: 1.8rem;
            color: #813f26;
            font-size: 0.95rem;
            background: rgba(252, 208, 138, 0.5);
            padding: 0.6rem 1rem;
            border-radius: 60px;
            border: 1px dashed #f0702a;
            backdrop-filter: blur(4px);
        }
        .demo-hint strong {
            background: #fef7b6;
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            margin: 0 4px;
            font-family: monospace;
            font-size: 1.2rem;
            color: #b62b0c;
        }

        /* å°é›ªèŠ±/é‡‘å…ƒå®è£…é¥° (è½»ç›ˆ) */
        .coin {
            position: absolute;
            color: rgba(255, 215, 0, 0.2);
            font-size: 2.5rem;
            user-select: none;
            z-index: 0;
            transform: rotate(15deg);
        }
        .coin1 { top: 8%; left: 18%; }
        .coin2 { bottom: 12%; right: 20%; transform: rotate(-10deg); }
    </style>
</head>
<body>
    <!-- ç¯ç¬¼ -->
    <div class="lantern-left"></div>
    <div class="lantern-right"></div>
    <!-- èƒŒæ™¯ç¥¥äº‘ -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <!-- å°å…ƒå®è£…é¥° -->
    <div class="coin coin1">ğŸ§§</div>
    <div class="coin coin2">ğŸ‹</div>

    <main class="activate-card">
        <h1 class="newyear-title">ä¸™åˆçº³ç¦</h1>
        <div class="newyear-sub">ğŸ´ æ–°æ˜¥æ¿€æ´» Â· é©¬åˆ°æˆåŠŸ</div>

        <!-- æ¿€æ´»è¡¨å• -->
        <form id="activationForm">
            <div class="code-label">
                <span>ğŸ”‘</span> è¾“å…¥6ä½æ¿€æ´»ç  <span>ğŸ</span>
            </div>
            <input type="text" id="codeInput" class="code-input" 
                   placeholder="å¦‚ as89g6" maxlength="6" 
                   autocomplete="off" inputmode="text" autofocus>

            <div id="messageBox" class="message-area">
                <span id="messageText" class="info-message">ğŸ® è¾“å…¥6ä½ç ï¼Œå­—æ¯æ•°å­—ç»„åˆ</span>
            </div>

            <button type="submit" id="submitBtn" class="activate-btn">
                <i>ğŸ§¨</i> æ¿€æ´» <i>âœ¨</i>
            </button>
        </form>

        <div class="demo-hint">
            ğŸ’¡ ç¤ºä¾‹ï¼š<strong>a1b2c3</strong> <strong>m8n9p7</strong> <br>
            âš¡ ä¸åŒºåˆ†å¤§å°å†™ Â· è‡ªåŠ¨æ ¡éªŒåå°é¡µé¢
        </div>
    </main>

    <script>
        (function() {
            // DOM å…ƒç´ 
            const form = document.getElementById('activationForm');
            const input = document.getElementById('codeInput');
            const submitBtn = document.getElementById('submitBtn');
            const messageText = document.getElementById('messageText');

            // çŠ¶æ€æ§åˆ¶
            let isChecking = false;
            let currentController = null;  // ç”¨äºä¸­æ–­æ—§è¯·æ±‚

            // è¾…åŠ©ï¼šæ›´æ–°æ¶ˆæ¯æ ·å¼
            function setMessage(text, type = 'info') {
                messageText.innerText = text;
                // ç§»é™¤ç°æœ‰æ ·å¼ç±»
                messageText.classList.remove('error-message', 'success-message', 'info-message');
                if (type === 'error') {
                    messageText.classList.add('error-message');
                } else if (type === 'success') {
                    messageText.classList.add('success-message');
                } else {
                    messageText.classList.add('info-message');
                }
            }

            // æ ¡éªŒæ¿€æ´»ç æ ¼å¼ (6ä½ï¼ŒåŒæ—¶åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œä¸åŒºåˆ†å¤§å°å†™ -> å†…éƒ¨ç»Ÿä¸€å°å†™)
            function isValidFormat(code) {
                // è§„åˆ™ï¼š^[a-z0-9]{6}$ ä¸”å¿…é¡»è‡³å°‘ä¸€ä¸ªå­—æ¯å’Œä¸€ä¸ªæ•°å­—ï¼ˆç¬¦åˆé¢˜æ„â€œå«æ•°å­—å’Œå­—æ¯â€ï¼‰
                const regex = /^(?=.*[a-z])(?=.*\d)[a-z0-9]{6}$/;
                return regex.test(code);
            }

            // åå°åˆè§„æ ¡éªŒ (æ ¸å¿ƒ)
            async function checkPageExists(code) {
                // æ„å»ºç›¸å¯¹è·¯å¾„ï¼š {code}/index.html   (ä¸åç»­è·³è½¬è·¯å¾„ä¸€è‡´)
                const targetPath = `./${code}/index.html`;  // ç›¸å¯¹äºå½“å‰æ¿€æ´»é¡µé¢çš„è·¯å¾„

                // å¦‚æœæœ‰æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ï¼Œå…ˆä¸­æ–­å®ƒ
                if (currentController) {
                    currentController.abort();
                }
                currentController = new AbortController();
                const { signal } = currentController;

                try {
                    // ä½¿ç”¨ HEAD è¯·æ±‚ï¼Œè½»é‡æ ¡éªŒï¼Œä¸”é¿å…ç¼“å­˜
                    const response = await fetch(targetPath, {
                        method: 'HEAD',
                        cache: 'no-cache',
                        signal: signal
                    });

                    // è¯·æ±‚æˆåŠŸï¼ˆ2xxï¼‰ä»£è¡¨é¡µé¢å­˜åœ¨ä¸”åˆè§„ (GitHub Pages ä¼šé’ˆå¯¹å­˜åœ¨çš„index.htmlè¿”å›200)
                    if (response.ok) {
                        return { exists: true, url: targetPath };
                    } 
                    // 404 æˆ–è€…å…¶å®ƒé”™è¯¯çŠ¶æ€
                    else if (response.status === 404) {
                        return { exists: false, status: 404, url: targetPath };
                    } else {
                        // å…¶å®ƒçŠ¶æ€ï¼ˆ500, 403ç­‰ï¼‰ä¹Ÿç®—ä¸å¯ç”¨
                        return { exists: false, status: response.status, url: targetPath };
                    }
                } catch (error) {
                    // å¦‚æœæ˜¯ç”¨æˆ·æ‰‹åŠ¨ä¸­æ–­ (abort) ä¸è§†ä¸ºé”™è¯¯
                    if (error.name === 'AbortError') {
                        console.log('è¯·æ±‚è¢«å–æ¶ˆ');
                        return { exists: null, aborted: true };
                    }
                    // ç½‘ç»œé”™è¯¯ / è·¨åŸŸ / æ— æ³•è¿æ¥
                    return { exists: false, error: true, details: error.message };
                } finally {
                    currentController = null;
                }
            }

            // å¤„ç†è¡¨å•æäº¤
            async function handleSubmit(event) {
                event.preventDefault();

                // å¦‚æœæ­£åœ¨æ ¡éªŒä¸­ï¼Œé˜»æ­¢é‡å¤æäº¤
                if (isChecking) {
                    setMessage('â³ æ­£åœ¨æ ¡éªŒï¼Œè¯·ç¨å€™...', 'info');
                    return;
                }

                // 1. è·å–è¾“å…¥å¹¶æ¸…ç†
                let rawCode = input.value.trim();
                if (rawCode === '') {
                    setMessage('âŒ è¯·è¾“å…¥æ¿€æ´»ç ', 'error');
                    input.focus();
                    return;
                }

                // ç»Ÿä¸€è½¬ä¸ºå°å†™ (å­—æ¯ä¸åŒºåˆ†å¤§å°å†™)
                const lowerCode = rawCode.toLowerCase();

                // 2. æ ¼å¼æ ¡éªŒ (åŒ…å«æ•°å­—+å­—æ¯å„è‡³å°‘ä¸€ä½ï¼Œé•¿åº¦6)
                if (!isValidFormat(lowerCode)) {
                    setMessage('ğŸ§ æ¿€æ´»ç å¿…é¡»ä¸º6ä½ï¼Œä¸”åŒæ—¶åŒ…å«æ•°å­—å’Œå­—æ¯', 'error');
                    input.select();
                    return;
                }

                // 3. å¼€å§‹åå°åˆè§„æ ¡éªŒ
                isChecking = true;
                submitBtn.disabled = true;
                setMessage('ğŸ” æ­£åœ¨æ ¸å¯¹æ¿€æ´»èµ„æ ¼ (æ ¡éªŒåå°é¡µé¢)...', 'info');

                // è°ƒç”¨åå°æ ¡éªŒ (æ¨¡æ‹Ÿåå°è¯·æ±‚)
                const result = await checkPageExists(lowerCode);

                // å¦‚æœè¯·æ±‚è¢«ä¸­æ–­ (abort) åˆ™æ¢å¤ä½†ä¸æ˜¾ç¤ºé”™è¯¯
                if (result.aborted) {
                    isChecking = false;
                    submitBtn.disabled = false;
                    // ä¸æ¸…é™¤æ¶ˆæ¯ï¼Œå› ä¸ºå¯èƒ½è¢«æ–°è¯·æ±‚è¦†ç›–ï¼Œæ­¤å¤„ç®€å•ç½®ä¸ºå°±ç»ª
                    setMessage('ğŸ® è¯·é‡æ–°å°è¯•æ¿€æ´»', 'info');
                    return;
                }

                // 4. å¤„ç†æ ¡éªŒç»“æœ
                if (result.exists) {
                    // åˆè§„ï¼è·³è½¬åˆ°å¯¹åº” index.html
                    setMessage('ğŸ‰ æ ¡éªŒæˆåŠŸï¼å³å°†è¿›å…¥...', 'success');

                    // ç¨å¾®å»¶è¿Ÿè·³è½¬ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæç¤º (åŒæ—¶é˜²æ­¢å¤šæ¬¡ç‚¹å‡»)
                    setTimeout(() => {
                        // ä½¿ç”¨ç›¸å¯¹è·¯å¾„è·³è½¬ (ä¸æ ¡éªŒè·¯å¾„ä¸€è‡´)
                        window.location.href = `./${lowerCode}/index.html`;
                    }, 300);
                    // æ³¨æ„ï¼šè·³è½¬ä¼šå¸è½½å½“å‰é¡µé¢ï¼Œåç»­ä»£ç ä¸å†æ‰§è¡Œ
                } else {
                    // ä¸åˆè§„ (404æˆ–å…¶å®ƒé”™è¯¯)
                    if (result.status === 404) {
                        setMessage('âŒ æ¿€æ´»ç æ— æ•ˆ (åå°é¡µé¢ä¸å­˜åœ¨/404)', 'error');
                    } else if (result.error) {
                        setMessage(`âš ï¸ ç½‘ç»œæˆ–åå°å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•`, 'error');
                        console.warn('æ ¡éªŒé”™è¯¯:', result.details);
                    } else {
                        setMessage(`âŒ åå°é¡µé¢ä¸å¯ç”¨ (çŠ¶æ€ç : ${result.status})`, 'error');
                    }

                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    isChecking = false;
                    submitBtn.disabled = false;
                    input.select();
                }

                // å¦‚æœä¸æ˜¯è·³è½¬æƒ…å†µï¼Œæ¢å¤çŠ¶æ€ï¼ˆä½†è·³è½¬åä¸‹é¢çš„ä»£ç ä¸ä¼šæ‰§è¡Œï¼‰
                if (!result.exists) {
                    isChecking = false;
                    submitBtn.disabled = false;
                }
            }

            // ç›‘å¬è¡¨å•æäº¤
            form.addEventListener('submit', handleSubmit);

            // é™„åŠ ï¼šè¾“å…¥æ¡†æŒ‰å›è½¦è§¦å‘æäº¤ (ç”±è¡¨å•è‡ªåŠ¨å¤„ç†)
            // å®æ—¶è¾“å…¥æ—¶ï¼Œå¦‚æœä¹‹å‰æœ‰é”™è¯¯ä¿¡æ¯ä¸”å†æ¬¡è¾“å…¥ï¼Œå¯ä»¥æ¸…ä¸€ä¸‹æ—§æç¤º
            input.addEventListener('input', function() {
                // å¦‚æœæ¶ˆæ¯æ˜¯é”™è¯¯ç±»ï¼Œå½“ç”¨æˆ·é‡æ–°è¾“å…¥æ—¶æ¢å¤ä¸ºæç¤º (ä½†ä¸æ˜¯å¿…é¡»)
                if (messageText.classList.contains('error-message')) {
                    setMessage('ğŸ® è¾“å…¥6ä½ç ï¼Œå­—æ¯æ•°å­—ç»„åˆ', 'info');
                }
            });

            // é¡µé¢å¸è½½æ—¶ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆï¼Œå¯ä»¥å–æ¶ˆ (ä½†é€šè¿‡controllerå·²å¤„ç†)
            window.addEventListener('beforeunload', function() {
                if (currentController) {
                    currentController.abort();
                }
            });

            // åˆå§‹å‹å¥½æç¤º (ä¹Ÿå¯ä»¥åœ¨åŠ è½½æ—¶å±•ç¤ºç¤ºä¾‹)
            // å¯é€‰: é¢„å¡«å……æ¼”ç¤ºdemo (æ–¹ä¾¿æµ‹è¯•, ä½†æ³¨é‡Šæ‰ä¿æŒç©ºç™½)
            // input.value = '';
        })();
    </script>

    <!-- é™„åŠ è¯´æ˜ï¼šç›®å½•ç»“æ„è¦æ±‚
         æœ¬é¡µé¢éœ€æ”¾ç½®åœ¨GitHub Pagesï¼ˆæˆ–ä»»ä½•é™æ€æœåŠ¡å™¨ï¼‰æ ¹ç›®å½•ã€‚
         æœ‰æ•ˆçš„æ¿€æ´»ç å¯¹åº”å­æ–‡ä»¶å¤¹ï¼Œä¸”å†…å« index.htmlã€‚ 
         ä¾‹å¦‚ï¼š/a1b2c3/index.html å­˜åœ¨ï¼Œå³å¯é€šè¿‡è¾“å…¥a1b2c3æ¿€æ´»è·³è½¬ã€‚
    -->
</body>
</html>
