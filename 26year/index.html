<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>ğŸ§§ ä¸™åˆÂ·å§“åå¯ç¦ ğŸ´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', 'WenQuanYi Micro Hei', sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(145deg, #9f1f1f 0%, #c53a2b 40%, #e86334 100%);
            background-attachment: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
            padding: 1rem;
        }

        /* ç¯ç¬¼è£…é¥° */
        .lantern-left, .lantern-right {
            position: absolute;
            top: 20px;
            width: 100px;
            height: 140px;
            background: radial-gradient(circle at 30% 20%, #ffcf9a, #d4320f 70%);
            border-radius: 50% 50% 40% 40%;
            box-shadow: 0 10px 20px rgba(180, 30, 0, 0.5), inset -5px -10px 10px rgba(0,0,0,0.2);
            transform-origin: top center;
            animation: swing 3s infinite ease-in-out;
            z-index: 5;
        }
        .lantern-left {
            left: 10px;
        }
        .lantern-right {
            right: 10px;
            animation-delay: 1s;
        }
        .lantern-left::before, .lantern-right::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: #c98b2b;
            border-radius: 30% 30% 0 0;
            box-shadow: 0 -2px 5px #ffb669;
        }
        .lantern-left::after, .lantern-right::after {
            content: 'ç¦';
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            font-weight: bold;
            color: #fde58b;
            text-shadow: 2px 2px 0 #b5451a;
            font-family: 'KaiTi', 'æ¥·ä½“', serif;
        }
        @keyframes swing {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(8deg); }
            75% { transform: rotate(-8deg); }
            100% { transform: rotate(0deg); }
        }

        /* é‡‘è‰²ç¥¥äº‘çº¹ (èƒŒæ™¯è£…é¥°) */
        .cloud {
            position: absolute;
            background: rgba(255, 235, 150, 0.15);
            border-radius: 80% 20% 70% 30% / 30% 70% 20% 80%;
            width: 200px;
            height: 80px;
            filter: blur(8px);
            z-index: 1;
        }
        .cloud1 { top: 15%; left: 5%; }
        .cloud2 { bottom: 10%; right: 3%; width: 280px; height: 100px; background: rgba(255, 200, 100, 0.1); }

        /* ä¸»å¡ç‰‡ */
        .activate-card {
            position: relative;
            z-index: 20;
            background: rgba(255, 250, 235, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 3px solid #f7d97e;
            border-radius: 48px 48px 32px 32px;
            box-shadow: 0 30px 40px rgba(160, 30, 0, 0.4), 0 0 0 2px #fcc15e inset, 0 0 0 5px #b33f1f inset;
            padding: 2.5rem 2rem;
            max-width: 520px;
            width: 100%;
            text-align: center;
        }

        /* æ–°å¹´ä¸»æ ‡é¢˜ */
        .newyear-title {
            font-size: 2.6rem;
            font-weight: 800;
            color: #a3201a;
            text-shadow: 3px 3px 0 #fee282, 5px 5px 0 rgba(255, 100, 0, 0.3);
            letter-spacing: 6px;
            margin-bottom: 0.2rem;
            line-height: 1.2;
        }
        .newyear-sub {
            font-size: 1.4rem;
            font-weight: 400;
            color: #cf4f2b;
            background: #fef1bc;
            display: inline-block;
            padding: 0.3rem 2rem;
            border-radius: 40px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 0 #b7621a;
            font-family: 'KaiTi', serif;
        }

        /* è¾“å…¥æ¡†ç»„ */
        .code-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: #772b1a;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .code-label span {
            font-size: 1.6rem;
        }

        .code-input {
            width: 100%;
            padding: 1rem 1.2rem;
            font-size: 1.8rem;
            text-align: center;
            letter-spacing: 2px;         /* é€‚åº”ä¸­æ–‡ */
            font-weight: 600;
            background: #fffbf0;
            border: 3px solid #c5481f;
            border-radius: 60px;
            outline: none;
            color: #3c1d0e;
            caret-color: #d4451e;
            box-shadow: inset 0 3px 8px rgba(150, 50, 0, 0.2), 0 4px 0 #954f2a;
            transition: all 0.2s;
        }
        .code-input:focus {
            border-color: #ffb347;
            box-shadow: inset 0 3px 8px rgba(200, 80, 0, 0.2), 0 4px 0 #c06924, 0 0 0 3px #fde6a2;
        }
        .code-input::placeholder {
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: #bc7a5a;
        }

        /* æç¤ºä¿¡æ¯ */
        .message-area {
            min-height: 3.2rem;
            margin: 0.8rem 0 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: #b13b1a;
            text-shadow: 0 1px 0 #ffd9a8;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .error-message {
            color: #a5220c;
            background: #ffdbac;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
            border-left: 6px solid #c0451b;
            font-weight: 600;
        }
        .success-message {
            color: #1f7a3b;
            background: #e1ffc6;
            border-left: 6px solid #2e9c47;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
        }
        .info-message {
            color: #7b4a2a;
            background: #ffeec2;
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
        }

        /* ç¥ç¦æŒ‰é’® */
        .activate-btn {
            background: linear-gradient(145deg, #fdc830, #f37335);
            border: none;
            padding: 1.2rem 1.5rem;
            width: 100%;
            font-size: 2rem;
            font-weight: 800;
            color: #2f1406;
            text-shadow: 2px 2px 0 #feda7a;
            border-radius: 60px;
            box-shadow: 0 10px 0 #aa401a, 0 6px 20px #ff8c42;
            cursor: pointer;
            transition: all 0.08s linear;
            letter-spacing: 4px;
            border: 2px solid #fdea9e;
            transform: translateY(0);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .activate-btn:active {
            transform: translateY(6px);
            box-shadow: 0 4px 0 #aa401a, 0 10px 20px #ffb161;
        }
        .activate-btn:disabled {
            opacity: 0.7;
            transform: translateY(5px);
            box-shadow: 0 5px 0 #7b3a1f;
            cursor: not-allowed;
            background: #d89c6c;
        }
        .activate-btn i {
            font-size: 2rem;
            font-style: normal;
            filter: drop-shadow(0 2px 2px #b3511c);
        }

        /* åº•éƒ¨æç¤º Â· æ˜ å°„è¯´æ˜ */
        .demo-hint {
            margin-top: 1.8rem;
            color: #813f26;
            font-size: 0.95rem;
            background: rgba(252, 208, 138, 0.5);
            padding: 0.8rem 1rem;
            border-radius: 60px;
            border: 1px dashed #f0702a;
            backdrop-filter: blur(4px);
            line-height: 1.6;
        }
        .demo-hint strong {
            background: #fef7b6;
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            margin: 0 4px;
            font-family: monospace;
            font-size: 1.1rem;
            color: #b62b0c;
        }
        .demo-hint code {
            background: #fbe9c3;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-family: monospace;
            color: #aa3f1c;
            font-size: 0.9rem;
        }

        /* å°å…ƒå®è£…é¥° */
        .coin {
            position: absolute;
            color: rgba(255, 215, 0, 0.2);
            font-size: 2.5rem;
            user-select: none;
            z-index: 0;
            transform: rotate(15deg);
        }
        .coin1 { top: 8%; left: 18%; }
        .coin2 { bottom: 12%; right: 20%; transform: rotate(-10deg); }
    </style>
</head>
<body>
    <!-- ç¯ç¬¼ (ä¿ç•™) -->
    <div class="lantern-left"></div>
    <div class="lantern-right"></div>
    <!-- èƒŒæ™¯ç¥¥äº‘ -->
    <div class="cloud cloud1"></div>
    <div class="cloud cloud2"></div>
    <!-- å°å…ƒå®è£…é¥° -->
    <div class="coin coin1">ğŸ§§</div>
    <div class="coin coin2">ğŸ‹</div>

    <main class="activate-card">
        <h1 class="newyear-title">ä¸™åˆÂ·å§“åå¯ç¦</h1>
        <div class="newyear-sub">ğŸ´ è¾“å…¥å§“å Â· é¢†å–ä¸“å±ç¥ç¦</div>

        <!-- è¡¨å• -->
        <form id="blessForm">
            <div class="code-label">
                <span>ğŸ§§</span> è¾“å…¥æ‚¨çš„å§“åæˆ–ç§°å‘¼ <span>ğŸŒ¸</span>
            </div>
            <input type="text" id="nameInput" class="code-input" 
                   placeholder="è¯·è¾“å…¥æ‚¨çš„å§“åæˆ–ç§°å‘¼" maxlength="20" 
                   autocomplete="off" inputmode="text" autofocus>

            <div id="messageBox" class="message-area">
                <span id="messageText" class="info-message">ğŸ® è¾“å…¥å§“åï¼ŒæŸ¥æ‰¾æ‚¨çš„ç¦è¿é“¾æ¥</span>
            </div>

            <button type="submit" id="submitBtn" class="activate-btn">
                <i>ğŸ§¨</i> é¢†å–ç¥ç¦ <i>âœ¨</i>
            </button>
        </form>

        <!-- æ˜ å°„æ–‡ä»¶æ ¼å¼è¯´æ˜ (æ˜¾å¼å‘ŠçŸ¥ç”¨æˆ·) -->
        <div class="demo-hint">
            ğŸ”” è‹±æ–‡å§“åä¸åŒºåˆ†å¤§å°å†™ï¼Œå¿½ç•¥é¦–å°¾ç©ºæ ¼ Â· åŒ¹é…åè‡ªåŠ¨è·³è½¬è‡³å¯¹åº”é“¾æ¥ Â· MADE BY <strong>ZZX</strong>
        </div>
    </main>

    <script>
        (function() {
            // DOM å…ƒç´ 
            const form = document.getElementById('blessForm');
            const input = document.getElementById('nameInput');
            const submitBtn = document.getElementById('submitBtn');
            const messageText = document.getElementById('messageText');

            // çŠ¶æ€æ§åˆ¶
            let isChecking = false;               // é˜²æ­¢é‡å¤æäº¤
            // ç¼“å­˜æ˜ å°„æ•°æ®å’Œpromise (é¿å…é‡å¤fetch)
            let mappingPromise = null;             
            let normalizedMap = null;              // è§„èŒƒåŒ–åçš„Map: å°å†™trim(å§“å) -> { original, link }

            // è¾…åŠ©ï¼šæ›´æ–°æ¶ˆæ¯æ ·å¼
            function setMessage(text, type = 'info') {
                messageText.innerText = text;
                messageText.classList.remove('error-message', 'success-message', 'info-message');
                if (type === 'error') {
                    messageText.classList.add('error-message');
                } else if (type === 'success') {
                    messageText.classList.add('success-message');
                } else {
                    messageText.classList.add('info-message');
                }
            }

            // è·å–æ˜ å°„æ•°æ® (è¿”å›promiseï¼Œç¼“å­˜ç»“æœ)
            function fetchMapping() {
                if (mappingPromise) {
                    return mappingPromise;
                }
                // åˆæ¬¡fetch
                mappingPromise = new Promise((resolve, reject) => {
                    fetch('./mapping.json', {
                        method: 'GET',
                        cache: 'no-cache',
                        headers: { 'Accept': 'application/json' }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status} æ— æ³•åŠ è½½æ˜ å°„æ–‡ä»¶`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // æ ¡éªŒdataåº”ä¸ºå¯¹è±¡ï¼ˆä¸”éæ•°ç»„ã€énullï¼‰
                        if (!data || typeof data !== 'object' || Array.isArray(data)) {
                            throw new Error('æ˜ å°„æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼šåº”ä¸ºJSONå¯¹è±¡ { "å§“å":"é“¾æ¥" }');
                        }
                        // æ„å»ºè§„èŒƒåŒ–Map (é”®: å°å†™+trim, å€¼: { originalKey, link })
                        const map = new Map();
                        for (const [key, link] of Object.entries(data)) {
                            if (typeof key !== 'string' || typeof link !== 'string') {
                                console.warn(`æ˜ å°„æ¡ç›®è·³è¿‡: å§“åæˆ–é“¾æ¥ä¸æ˜¯å­—ç¬¦ä¸² (${key}: ${link})`);
                                continue;
                            }
                            const normalizedKey = key.trim().toLowerCase();
                            if (normalizedKey === '') {
                                console.warn('æ˜ å°„æ¡ç›®è·³è¿‡: å§“åä¸ºç©ºå­—ç¬¦ä¸²');
                                continue;
                            }
                            // å¦‚æœé‡å¤ï¼Œåé¢è¦†ç›–å‰é¢ï¼ˆå¯æç¤ºï¼‰
                            if (map.has(normalizedKey)) {
                                console.warn(`æ£€æµ‹åˆ°é‡å¤çš„å§“åæ˜ å°„ï¼šâ€œ${key}â€ä¸â€œ${map.get(normalizedKey).originalKey}â€å½’ä¸€åŒ–åå†²çªï¼Œå°†ä½¿ç”¨åè€…çš„é“¾æ¥`);
                            }
                            map.set(normalizedKey, {
                                originalKey: key,
                                link: link
                            });
                        }
                        normalizedMap = map;
                        resolve(map);
                    })
                    .catch(error => {
                        // å¤±è´¥åæ¸…é™¤promiseç¼“å­˜ï¼Œä»¥ä¾¿é‡è¯•
                        mappingPromise = null;
                        reject(error);
                    });
                });
                return mappingPromise;
            }

            // å¤„ç†æäº¤
            async function handleSubmit(event) {
                event.preventDefault();

                // é˜²é‡å¤ç‚¹å‡»
                if (isChecking) {
                    setMessage('â³ æ­£åœ¨å¤„ç†ï¼Œè¯·ç¨å€™...', 'info');
                    return;
                }

                // 1. è·å–è¾“å…¥å¹¶æ¸…ç†
                let rawName = input.value.trim();
                if (rawName === '') {
                    setMessage('âŒ è¯·è¾“å…¥æ‚¨çš„å§“å', 'error');
                    input.focus();
                    return;
                }

                // è§„èŒƒåŒ–å§“å (ç”¨äºæŸ¥æ‰¾)
                const normalizedInput = rawName.toLowerCase();

                // 2. å¼€å§‹åå°æ˜ å°„æ ¡éªŒ
                isChecking = true;
                submitBtn.disabled = true;
                setMessage('ğŸ” æ­£åœ¨æŸ¥æ‰¾æ‚¨çš„ç¥ç¦...', 'info');

                try {
                    // è·å–æ˜ å°„è¡¨ (è‹¥ç¬¬ä¸€æ¬¡åŠ è½½å¯èƒ½ç­‰å¾…fetch)
                    await fetchMapping();   // å†…éƒ¨å¡«å…… normalizedMap
                    
                    if (!normalizedMap) {
                        throw new Error('æ˜ å°„è¡¨æœªæ­£ç¡®åˆå§‹åŒ–');
                    }

                    // æŸ¥æ‰¾
                    if (normalizedMap.has(normalizedInput)) {
                        const entry = normalizedMap.get(normalizedInput);
                        const targetLink = entry.link;
                        const originalName = entry.originalKey;

                        setMessage(`ğŸ‰ æ‰¾åˆ°å•¦ï¼è·³è½¬è‡³ ${originalName} çš„ç¥ç¦é¡µ âœ¨`, 'success');

                        // å»¶è¿Ÿè·³è½¬ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæç¤º
                        setTimeout(() => {
                            window.location.href = targetLink;
                        }, 400);
                        // æ³¨æ„ï¼šè·³è½¬åé¡µé¢å¸è½½ï¼Œä¸‹é¢çš„æ¢å¤æŒ‰é’®ä¸ä¼šæ‰§è¡Œ
                    } else {
                        // æœªæ‰¾åˆ°
                        setMessage(`ğŸ˜¢ æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°â€œ${rawName}â€å¯¹åº”çš„ç¥ç¦é“¾æ¥`, 'error');
                        isChecking = false;
                        submitBtn.disabled = false;
                        input.select();
                    }
                } catch (error) {
                    console.error('æ˜ å°„åŠ è½½/æŸ¥æ‰¾å¤±è´¥:', error);
                    setMessage(`âš ï¸ æ— æ³•åŠ è½½æ˜ å°„æ–‡ä»¶ï¼š${error.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    isChecking = false;
                    submitBtn.disabled = false;
                }
            }

            // ç»‘å®šæäº¤äº‹ä»¶
            form.addEventListener('submit', handleSubmit);

            // è¾“å…¥æ—¶æ¶ˆé™¤é”™è¯¯çŠ¶æ€ï¼ˆå‹å¥½ï¼‰
            input.addEventListener('input', function() {
                if (messageText.classList.contains('error-message')) {
                    setMessage('ğŸ® è¾“å…¥å§“åï¼ŒæŸ¥æ‰¾æ‚¨çš„ç¦è¿é“¾æ¥', 'info');
                }
            });

            // é¢„åŠ è½½æ˜ å°„ï¼ˆä¸é˜»å¡UIï¼Œè®©åç»­ç‚¹å‡»æ›´å¿«ï¼‰
            // ä½†ä¸ºäº†ä¸äº§ç”Ÿæœªæ•è·çš„rejectionï¼Œç”¨catchå¿½ç•¥
            fetchMapping().catch(e => {
                console.warn('é¢„åŠ è½½æ˜ å°„å¤±è´¥ï¼Œå¯åœ¨æäº¤æ—¶é‡è¯•', e);
            });

            // åˆå§‹æç¤º (ä¿ç•™)
        })();
    </script>

    <!-- ç›®å½•/æ˜ å°„è¯´æ˜ï¼ˆé¢å‘å¼€å‘è€…/ä½¿ç”¨è€…ï¼‰ 
         æ˜ å°„æ–‡ä»¶å¿…é¡»å‘½åä¸º mapping.json å¹¶æ”¾åœ¨æœ¬é¡µé¢åŒç›®å½•ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
         {
             "å¼ ä¸‰": "./zhangsan/index.html",
             "æå››": "./lisi/bless.html",
             "ç‹ä¸™åˆ": "/wang/index.html"
         }
         å§“åä¼šå¿½ç•¥é¦–å°¾ç©ºæ ¼ä¸”ä¸åŒºåˆ†å¤§å°å†™ã€‚åŒ¹é…åç›´æ¥è·³è½¬è‡³å¯¹åº”çš„é“¾æ¥ã€‚
    -->
</body>
</html>